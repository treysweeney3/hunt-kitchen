// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ================================
// ENUMS
// ================================

enum UserRole {
  CUSTOMER
  ADMIN
}

enum AddressType {
  SHIPPING
  BILLING
}

// ================================
// USER MODELS
// ================================

model User {
  id             String    @id @default(cuid())
  email          String    @unique
  passwordHash   String?   @map("password_hash")
  firstName      String    @map("first_name")
  lastName       String    @map("last_name")
  role           UserRole  @default(CUSTOMER)
  emailVerified  Boolean   @default(false) @map("email_verified")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  // Relations
  addresses      Address[]
  recipeRatings  RecipeRating[]
  savedRecipes   SavedRecipe[]

  @@index([email])
  @@index([role])
  @@map("users")
}

model Address {
  id               String      @id @default(cuid())
  userId           String      @map("user_id")
  addressType      AddressType @map("address_type")
  isDefault        Boolean     @default(false) @map("is_default")
  firstName        String      @map("first_name")
  lastName         String      @map("last_name")
  streetAddress1   String      @map("street_address_1")
  streetAddress2   String?     @map("street_address_2")
  city             String
  state            String
  postalCode       String      @map("postal_code")
  country          String      @default("US")
  phone            String
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")

  // Relations
  user             User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isDefault])
  @@map("addresses")
}

// ================================
// RECIPE MODELS
// ================================

model RecipeCategory {
  id           String    @id @default(cuid())
  name         String
  slug         String    @unique
  description  String?
  imageUrl     String?   @map("image_url")
  displayOrder Int       @default(0) @map("display_order")
  isActive     Boolean   @default(true) @map("is_active")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  // Relations
  recipes      RecipeCategoryJunction[]

  @@index([slug])
  @@index([isActive, displayOrder])
  @@map("recipe_categories")
}

model GameType {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  imageUrl    String?   @map("image_url")
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  recipes     Recipe[]

  @@index([slug])
  @@index([isActive])
  @@map("game_types")
}

model Recipe {
  id                 String     @id @default(cuid())
  title              String
  slug               String     @unique
  description        String
  featuredImageUrl   String?    @map("featured_image_url")
  galleryImages      Json?      @map("gallery_images")
  gameTypeId         String     @map("game_type_id")
  prepTimeMinutes    Int?       @map("prep_time_minutes")
  cookTimeMinutes    Int?       @map("cook_time_minutes")
  totalTimeMinutes   Int?       @map("total_time_minutes")
  servings           Int?
  ingredients        Json       @map("ingredients")
  instructions       Json       @map("instructions")
  tips               String?
  nutritionInfo      Json?      @map("nutrition_info")
  videoUrl           String?    @map("video_url")
  isFeatured         Boolean    @default(false) @map("is_featured")
  isPublished        Boolean    @default(false) @map("is_published")
  publishedAt        DateTime?  @map("published_at")
  viewCount          Int        @default(0) @map("view_count")
  metaTitle          String?    @map("meta_title")
  metaDescription    String?    @map("meta_description")
  createdAt          DateTime   @default(now()) @map("created_at")
  updatedAt          DateTime   @updatedAt @map("updated_at")

  // Relations
  gameType           GameType   @relation(fields: [gameTypeId], references: [id], onDelete: Restrict)
  categories         RecipeCategoryJunction[]
  ratings            RecipeRating[]
  savedByUsers       SavedRecipe[]

  @@index([slug])
  @@index([gameTypeId])
  @@index([isPublished, isFeatured])
  @@index([isPublished, publishedAt])
  @@map("recipes")
}

model RecipeCategoryJunction {
  recipeId   String   @map("recipe_id")
  categoryId String   @map("category_id")

  // Relations
  recipe     Recipe         @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  category   RecipeCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@id([recipeId, categoryId])
  @@index([categoryId])
  @@map("recipe_categories_junction")
}

model RecipeRating {
  id         String    @id @default(cuid())
  recipeId   String    @map("recipe_id")
  userId     String?   @map("user_id")
  rating     Int
  reviewText String?   @map("review_text")
  isApproved Boolean   @default(false) @map("is_approved")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")

  // Relations
  recipe     Recipe    @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  user       User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([recipeId])
  @@index([userId])
  @@index([recipeId, isApproved])
  @@map("recipe_ratings")
}

model SavedRecipe {
  userId    String   @map("user_id")
  recipeId  String   @map("recipe_id")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  recipe    Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@id([userId, recipeId])
  @@index([recipeId])
  @@map("saved_recipes")
}

// ================================
// MARKETING MODELS
// ================================

model NewsletterSubscriber {
  id            String    @id @default(cuid())
  email         String    @unique
  firstName     String?   @map("first_name")
  isSubscribed  Boolean   @default(true) @map("is_subscribed")
  subscribedAt  DateTime  @default(now()) @map("subscribed_at")
  unsubscribedAt DateTime? @map("unsubscribed_at")
  source        String?

  @@index([email])
  @@index([isSubscribed])
  @@map("newsletter_subscribers")
}

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String
  isRead    Boolean  @default(false) @map("is_read")
  isReplied Boolean  @default(false) @map("is_replied")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([isRead])
  @@index([createdAt])
  @@map("contact_submissions")
}
